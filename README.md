# client-server
Простые клиент-сервер для сбора и просмотра метрик
Курсовая работа курса "Программирование на Python"
Предположим, необходимо собирать метрики о работе операционной системы: cpu (загрузка процессора), memory usage (потребление памяти), disk usage (потребление места на жестком диске), network usage (статистика сетевых интерфейсов) и т.д. Это понадобится для контроля загрузки серверов и прогноза по расширению парка железа компании - проще говоря для мониторинга.

Пусть у нас имеется в наличии два сервера palm и eardrum. Мы будем получать загрузку центрального процессора на сервере и отправлять метрику с названием имя_сервера.cpu

Чтобы отправить метрику на сервер, вы отправляете в TCP-соединение строку вида:

put palm.cpu 10.6 1501864247\n

Ключевое слово put означает команду отправки метрики. За ней через пробел следует название (имя) самой метрики, например palm.cpu, далее опять через пробел значение метрики, и через еще один пробел временная метка unix timestamp. Таким образом, во время 1501864247 значение метрики palm.cpu было равно 10.6. Наконец, команда заканчивается символом переноса строки \n.

В ответ на эту команду put сервер присылает уведомление об успешном сохранении метрики в виде строки:

ok\n\n

Два переноса строки в данном случае означают маркер конца сообщения от сервера клиенту.
Команды

Необходимо реализовать две команды:

put - для сохранения метрик на сервере.

get - для получения метрик.

Формат команды put для отправки метрик — это строка вида:

put <key> <value> <timestamp>\n

Успешный ответ от сервера:

ok\n\n

Ошибка сервера:

error\nwrong command\n\n

За каждым ответом сервера указано два символа \n. В качестве значения метрики value используется вещественное число.

Данные нужно не только отправлять на сервер, но и запрашивать их. Это может потребоваться для визуализации и анализа нужных метрик в определенные промежутки времени.

Формат команды get для получения метрик — это строка вида:

get <key>\n

В качестве ключа можно указывать символ *, для этого символа будут возвращены все доступные метрики.

Успешный ответ от сервера:

ok\npalm.cpu 10.5 1501864247\neardrum.cpu 15.3 1501864259\n\n

Если ни одна метрика не удовлетворяет условиям поиска, то вернется ответ:

ok\n\n

Обратите внимание, что каждая успешная операция начинается с "ok", а за ответом сервера всегда указано два символа \n.
Реализация клиента.

Необходимо реализовать класс Client, в котором будет инкапсулировано соединение с сервером, клиентский сокет и методы для получения и отправки метрик на сервер. В конструктор класса Client должна передаваться адресная пара хост и порт, а также необязательный аргумент timeout (timeout=None по умолчанию). У класса Client должно быть 2 метода: put и get, соответствующих протоколу выше.


Клиент получает данные в текстовом виде, метод get должен возвращать словарь с полученными ключами с сервера. Значением ключа в словаре является список кортежей [(timestamp, metric_value), ...] Значение timestamp должно быть преобразовано к целому числу int. Значение метрики metric_value нужно преобразовать к числу с плавающей точкой float.

Метод put принимает первым аргументом название метрики, вторым численное значение, третьим -  аргумент timestamp. Е


Метод get принимает первым аргументом имя метрики, значения которой мы хотим выгрузить. Также вместо имени метрики можно использовать символ *, о котором говорилось в описании протокола.

Если в ответ на get-запрос сервер вернул положительный ответ ok\n\n, но без данных (то есть данных по запрашиваемому ключу нет), то метод get клиентадолжен вернуть пустой словарь:


Итак, вам необходимо предоставить модуль с классом Client, исключением ClientError. В этом классе Client должны быть доступны методы get и put с описанной выше сигнатурой. При вызове методов get и put клиент должен посылать сообщения в TCP-соединение с сервером в соответствии с описанным текстовым протоколом, получать ответ от сервера, преобразовывать его в удобный для использования формат, описанный выше.
